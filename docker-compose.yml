services:
  fm-cli:
    build:
      context: ./fm-cli
      dockerfile: Dockerfile
    container_name: fm-cli
    restart: unless-stopped
    ports:
      - "3021:3001"
    environment:
      - NODE_ENV=production
      - PORT=3001
      - FM_API_URL=https://integration.fmtransportes.com.br/api
      - FM_API_USER=apikey
      - FM_API_PASSWORD=0663acdd9ee44005e6ea08dd0ae339c0afa33e1e55e541fa8fa37c7c9abc5086
      - FM_CLIENT_DOCUMENT=34383648835
      # IMPORTANTE: Usar URL externa porque fm-cli e tiny-cli estao em redes Docker diferentes
      - TINY_API_URL=http://tiny.sdebot.top:3011/api/tiny
      - CORS_ORIGINS=http://localhost:3000,http://127.0.0.1:3000,https://fm.sdebot.top
      - DB_HOST=sql.sdebot.top
      - DB_PORT=5432
      - DB_USER=sde_admin
      - DB_PASSWORD=PgRPxiqOvn2025
      - DB_NAME=fretes_sde
    networks:
      - fm-network
      - easypanel-n8n
    extra_hosts:
      - "host.docker.internal:host-gateway"

  fm-web:
    build:
      context: ./fm-web
      dockerfile: Dockerfile
      args:
        - NEXT_PUBLIC_API_URL=https://fm.sdebot.top/api
    container_name: fm-web
    restart: unless-stopped
    ports:
      - "3020:3000"
    environment:
      - NODE_ENV=production
    depends_on:
      - fm-cli
    networks:
      - fm-network

networks:
  fm-network:
    driver: bridge
  easypanel-n8n:
    external: true
